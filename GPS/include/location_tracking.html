<!DOCTYPE html>
<html>
<head>
  <title>실시간 위치 추적</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=6uHPB650j41F9NmAfTKjs5DxEZ0eBcTC77dm55iX"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    #map { width: 100%; height: 500px; }
  </style>
</head>
<body>
  <h2>실시간 위치 추적 지도</h2>
  <div id="map"></div>

  <script>
    let map, marker;

    function initMap() {
      map = new Tmapv2.Map("map", {
        center: new Tmapv2.LatLng(37.338227,127.109352), // 초기 좌표 (서울)
        width: "100%",
        height: "500px",
        zoom: 15
      });

      marker = new Tmapv2.Marker({
        position: new Tmapv2.LatLng(37.338227,127.109352),
        map: map
      });
    }

    function updateMarker(lat, lng) {
      const newPos = new Tmapv2.LatLng(lat, lng);
      marker.setPosition(newPos);
      map.setCenter(newPos); // 지도 중심도 같이 이동
    }

    $(document).ready(function() {
      initMap();

      const socket = io(); // 서버에 연결

      socket.on('location', (data) => {
        const { lat, lng } = data;
        updateMarker(lat, lng);
      });
    });
  </script>
</body>
</html>
